(function(t){function e(e){for(var i,r,o=e[0],c=e[1],l=e[2],d=0,h=[];d<o.length;d++)r=o[d],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&h.push(s[r][0]),s[r]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);u&&u(e);while(h.length)h.shift()();return a.push.apply(a,l||[]),n()}function n(){for(var t,e=0;e<a.length;e++){for(var n=a[e],i=!0,o=1;o<n.length;o++){var c=n[o];0!==s[c]&&(i=!1)}i&&(a.splice(e--,1),t=r(r.s=n[0]))}return t}var i={},s={app:0},a=[];function r(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=i,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;a.push(["80bd","chunk-vendors"]),n()})({"164a":function(t,e,n){},"2aa3":function(t,e,n){t.exports=n.p+"static/img/lamp.da1b67cc.png"},"31d9":function(t,e,n){"use strict";n("df46")},"60c4":function(t,e,n){"use strict";n("8efe")},"712f":function(t,e,n){t.exports=n.p+"static/img/linght-off.ef456b22.png"},"80bd":function(t,e,n){"use strict";n.r(e);n("0e31");var i=n("f06e"),s=(n("eb64"),n("8fde")),a=(n("148f"),n("f237")),r=(n("e3c7"),n("408b")),o=n("a593"),c=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[n("router-view")],1)},l=[],u=n("5d22"),d={},h=Object(u["a"])(d,c,l,!1,null,null,null),p=h.exports,f=n("8aaf"),g=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"home"},[i("OfflineNotice",{attrs:{show:!t.isOnline,loading:t.isFleshing},on:{onReflesh:t.reflesh}}),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isOn,expression:"isOn"}],staticClass:"device"},[["ceiling17"===t.lightType?i("img",{attrs:{src:n("b265")}}):"lamp9"===t.lightType?i("img",{attrs:{src:n("2aa3")}}):i("img",{attrs:{src:n("bce5")}})],i("p",[t._v(t._s(t.deviceName))]),t.permission.power?i("van-button",{staticClass:"open-btn--on",attrs:{disabled:!t.isOnline},on:{click:function(e){return t.openLight(!1)}}}):t._e()],2),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isOn,expression:"!isOn"}],staticClass:"device"},[["ceiling17"===t.lightType?i("img",{attrs:{src:n("b265")}}):"lamp9"===t.lightType?i("img",{attrs:{src:n("2aa3")}}):i("img",{attrs:{src:n("712f")}})],i("p",[t._v(t._s(t.deviceName))]),t.permission.power?i("van-button",{staticClass:"open-btn--off",attrs:{disabled:!t.isOnline},on:{click:function(e){return t.openLight(!0)}}}):t._e()],2),t.permission.brightness?i("div",{staticClass:"control"},[i("p",[t._v("亮度 "+t._s(t.light)+"%")]),i("van-slider",{attrs:{min:t.lightMin,max:t.lightMax,disabled:!t.isOnline,"bar-height":"0.8rem","active-color":"linear-gradient(to right, #FEBF32, #FFB06B)"},on:{input:function(e){return t.inputChange("light")},"drag-start":t.dragStart,"drag-end":t.dragEnd},scopedSlots:t._u([{key:"button",fn:function(){return[i("div",{staticClass:"light-control--btn"})]},proxy:!0}],null,!1,3337325327),model:{value:t.light,callback:function(e){t.light=e},expression:"light"}})],1):t._e(),t.permission.color_temp?i("div",{staticClass:"control mgt60"},[i("p",[t._v("色温")]),i("van-slider",{attrs:{min:t.tempMin,max:t.tempMax,disabled:!t.isOnline,"bar-height":"0.8rem","active-color":"transparent","inactive-color":"linear-gradient(90deg, #FFB06B, #FFD26E 40%, #7ECFFC)"},on:{input:function(e){return t.inputChange("temperature")},"drag-start":t.dragStart,"drag-end":t.dragEnd},scopedSlots:t._u([{key:"button",fn:function(){return[i("div",{staticClass:"pf-control--btn"})]},proxy:!0}],null,!1,2291241223),model:{value:t.temperature,callback:function(e){t.temperature=e},expression:"temperature"}})],1):t._e()],1)},m=[],v=(n("a450"),n("d91d"),n("1585")),b=(n("fc02"),n("1bc7"),n("e680"),n("7635")),w=n.n(b),y="production",_=function(){var t=/https/.test(window.location.protocol);return"development"===y?"ws://192.168.0.123:8088/ws":t?"wss://".concat(window.location.host,"/ws"):"ws://".concat(window.location.host,"/ws")},O=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("van-notice-bar",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],staticClass:"notice",attrs:{color:"#F6AE1E",background:"#FDF3DF",scrollable:!1,text:"当前设备已离线，连接局域网后才能控制此设备"},scopedSlots:t._u([{key:"right-icon",fn:function(){return[n("div",{staticClass:"notice-right",on:{click:t.reflesh}},[n("van-icon",{class:{"a-rotate":t.loading},attrs:{name:"replay"}}),n("span",[t._v("刷新")])],1)]},proxy:!0}])})},x=[],C={name:"offlineNotice",props:{show:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},methods:{reflesh:function(){this.$emit("onReflesh")}}},k=C,M=(n("60c4"),Object(u["a"])(k,O,x,!1,null,"13434edc",null)),F=M.exports,I={name:"home",components:{OfflineNotice:F},data:function(){return{ws:null,deviceName:"智能灯",isOn:!1,light:0,lightMin:0,lightMax:100,tempMin:0,tempMax:100,temperature:0,isOnline:!0,deviceId:"",pluginId:"",identity:"",instanceId:"",saId:"",token:"",permission:{brightness:!1,color_temp:!1,power:!1},stateId:1,perId:1,isLock:!1,isReady:!1,lastTime:null,lightType:"ceiling17",isFleshing:!1}},methods:{reflesh:function(){this.isReady=!1,this.isFleshing=!0,this.initData()},initData:function(){this.getDeviceState()},getDeviceState:function(){this.stateId=Number("1".concat(Date.now())),this.ws.send({id:this.stateId,domain:this.pluginId,service:"get_attributes",identity:this.identity})},sendCommand:function(t,e){this.ws.send({id:1,domain:this.pluginId,service:"set_attributes",identity:this.identity,service_data:{attributes:[{attribute:t,instance_id:this.instanceId,val:e}]}})},openLight:function(t){t?this.sendCommand("power","on"):this.sendCommand("power","off"),this.isOn=t},dragStart:function(){this.isLock=!0},dragEnd:function(){this.isLock=!1},inputChange:function(t){if(this.isReady){var e=Date.now(),n=500;e-this.lastTime-n>0&&("light"===t?this.lightChange(this.light):"temperature"===t&&this.temperatureChange(this.temperature),this.lastTime=e)}},lightChange:function(t){this.isOn&&this.sendCommand("brightness",t)},temperatureChange:function(t){this.isOn&&this.sendCommand("color_temp",t)},handleMessage:function(t){var e=this,n=JSON.parse(t);if(n.id===this.stateId){if(setTimeout((function(){e.isFleshing=!1}),1e3),!n.success)return void(this.isOnline=!1);this.isOnline=!0;var i=n.result.device.instances,s=i.filter((function(t){return"light_bulb"===t.type})),a=s[0].attributes;this.instanceId=s[0].instance_id,a.forEach((function(t){"power"===t.attribute?(e.isOn="on"===t.val,e.permission.power=t.can_control):"color_temp"===t.attribute?(e.temperature=t.val,e.tempMin=t.min,e.tempMax=t.max,e.permission.color_temp=t.can_control):"brightness"===t.attribute&&(e.light=t.val,e.lightMin=t.min,e.lightMax=t.max,e.permission.brightness=t.can_control)})),this.isReady=!0}if(n.event_type&&"attribute_change"===n.event_type){var r=n.data,o=r.attr;if(this.isLock)return void(r.identity===this.identity&&"power"===o.attribute&&(this.isOn="on"===o.val));r.identity===this.identity&&("power"===o.attribute?this.isOn="on"===o.val:"color_temp"===o.attribute?this.temperature=o.val:"brightness"===o.attribute&&(this.light=o.val))}},getUrlParams:function(t){var e=t.substr(t.indexOf("?")+1),n={},i=e.split("&");return i.forEach((function(t){var e=t.split("="),i=Object(v["a"])(e,2),s=i[0],a=i[1];n[s]=decodeURIComponent(a)})),n},getPercent:function(t,e,n){var i=Math.round(Number((n-e)/(t-e)*100));return i<0&&(i=0),i}},created:function(){var t=window.location,e=t.search,n=t.href,i=e?this.getUrlParams(e):this.getUrlParams(n);this.identity=i.identity,this.saId=i.sa_id,this.pluginId=i.plugin_id||"yeelight",this.lightType=i.model||"ceiling17",this.token=i.token,i.name&&(this.deviceName=i.name);var s=this;this.ws=new w.a({url:"".concat(_(),"?token=").concat(this.token,"&sa_id=").concat(this.saId),onOpen:function(){s.initData()},onMessage:function(t){s.handleMessage(t)}})}},S=I,j=(n("31d9"),n("f0a5"),Object(u["a"])(S,g,m,!1,null,"74a85bee",null)),E=j.exports;o["a"].use(f["a"]);var N=new f["a"]({mode:"hash",base:"",routes:[{path:"/",name:"home",component:E}]});n("164a");o["a"].use(i["a"]).use(s["a"]).use(a["a"]).use(r["a"]),o["a"].config.productionTip=!1,new o["a"]({router:N,render:function(t){return t(p)}}).$mount("#app")},"8efe":function(t,e,n){},abfa:function(t,e,n){},b265:function(t,e,n){t.exports=n.p+"static/img/led.0bd29fdd.png"},bce5:function(t,e,n){t.exports=n.p+"static/img/linght-on.f1364675.png"},df46:function(t,e,n){},f0a5:function(t,e,n){"use strict";n("abfa")}});